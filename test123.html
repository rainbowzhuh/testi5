<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<input type="file" capture="camera" accept="image/*" id="cameraInput" name="cameraInput" class="sign_file" style=""/>
<video id="video" width="640" height="480" autoplay></video>
<button id="snap">Snap Photo</button>
<canvas id="canvas" width="640" height="480"></canvas>
<script type="text/javascript">
var aVideo=document.getElementById('video');
var aCanvas=document.getElementById('canvas');
var ctx=aCanvas.getContext('2d');
 
 var sel, fr;
 
 
 
 
 
 
 

navigator.getUserMedia = navigator.getUserMedia ||
navigator.webkitGetUserMedia ||
navigator.mozGetUserMedia ||
navigator.msGetUserMedia;//获取媒体对象（这里指摄像头）
 
navigator.getUserMedia = navigator.getUserMedia || (navigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia || navigator.msGetUserMedia);

if (navigator.getUserMedia) {
  alert("aaa");
}
else if(navigator.webkitGetUserMedia){
 alert("bbb");
}
else if(navigator.mozGetUserMedia){
 alert("ccc");
}
else if(navigator.msGetUserMedia){
 alert("ddd");   
} 
else{
 var userAgent = navigator.userAgent;
 alert(userAgent);
 if (userAgent.indexOf("Safari") > -1 && userAgent.indexOf("Oupeng") == -1 && userAgent.indexOf("360 Aphone") == -1) {
    
 
   sel = document.getElementById('cameraInput');
   //var f = sel.files[0];
   //sel.click();
  
  
  
  sel.addEventListener('click', function (e) {
    alert("eee");
   
  });
 }
 else{
    alert("fff");
 }
 
}
 
navigator.getUserMedia({video:true,audio: false}, gotStream, noStream);//参数1获取用户打开权限；参数二成功打开后调用，并传一个视频流对象，参数三打开失败后调用，传错误信息
 
function gotStream(stream) {
 
 alert("123" + navigator.mozGetUserMedia);
 
video.src = URL.createObjectURL(stream);
video.onerror = function () {
stream.stop();
};
stream.onended = noStream;
video.onloadedmetadata = function () {
alert('摄像头成功打开！');
};
}
function noStream(err) {
alert("333"); 
alert(err);
}
 
 
 
document.getElementById("snap").addEventListener("click", function() {
 
ctx.drawImage(aVideo, 0, 0, 640, 480);//将获取视频绘制在画布上
});
 
 
 
 
 function receivedData() {
    alert("123");
  
     // readAsDataURL is finished - add URI to IMG tag src
     var canvas = document.getElementById("canvas");
     var context = canvas.getContext("2d");
     var imgtag = document.getElementById('imgtag'); // get reference to img tag
     imgtag.src = fr.result;
     $('#cream_loading').toggle();
 
     try {
         setTimeout(function () {
             context.drawImage(imgtag, 0, 0, 640, 480);
             convertCanvasToImage();
         }, 500);
 
     }
     catch (err) {
         alert(err);
     }
 }
</script>

</body>
</html>
