
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript" src="https://rainbowzhuh.github.io/testi5/jquery.js"></script>  
</head>
<body>
  <input type="file" capture="camera" accept="image/*" id="cameraInput" name="cameraInput" class="sign_file" style="display:none"/>
  <div style="width:100%;font-size:60px;text-align:center;margin-top:50px;">
    <a href="javascript:clickTest()" style="">点击测试</a>  
  </div>
  <video id="video" width="640" height="480" autoplay="" style="display:none;"></video>
  <!--<button id="snap">Snap Photo</button>-->
  <canvas id="canvas" width="640" height="480" ></canvas>
  <img src="" id="imgtag" style="display:none" width="640" />
  <script type="text/javascript">
    var sel, fr;
    function clickTest(){
      $("#cameraInput").click();
    }
    
    $(document).ready(function(){
      try{
        sel = document.getElementById('cameraInput');
        window.addEventListener("DOMContentLoaded", function () {
              var canvas = document.getElementById("canvas"),
              context = canvas.getContext("2d"),
              video = document.getElementById("video"),
              videoObj = { "video": true },
              errBack = function (error) {
                alert(error);
              }
        
        navigator.getMedia = ( navigator.getUserMedia ||
                           navigator.webkitGetUserMedia ||
                           navigator.mozGetUserMedia ||
                           navigator.msGetUserMedia);
       
        var userAgent = navigator.userAgent;
        if (navigator.getMedia) {
              navigator.getMedia({video: true,audio: false}, gotStream, noStream);
        }
        else{
          if(userAgent.indexOf("Safari") > -1 && userAgent.indexOf("Oupeng") == -1 && userAgent.indexOf("360 Aphone") == -1) {
            sel.addEventListener('change', function (e) {
              
              var f = sel.files[0];
              fr = new FileReader();
              fr.onload = receivedData;
              fr.readAsDataURL(f);
            })
          
            //$('#imgtag').show();
            clickTest();
        }
        else{
          alert("对不起，您的浏览器不支持拍照功能，请使用其他浏览器");
        }
        } 
        });
      }
      catch(err){
        alert("catch err");
      }
      
    
    });
    
    function receivedData(){
      
      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      var imgtag = document.getElementById('imgtag'); // get reference to img tag
      imgtag.src = fr.result;
      
      
      try {
         setTimeout(function () {
             $('#imgtag').show();
           
             /*context.drawImage(imgtag, 0, 0, 320, 320);
             convertCanvasToImage();*/
         }, 500);
 
     }
     catch (err) {
         alert(err);
     } 
    }
    
    function convertCanvasToImage(canvas){
      /*var image = new Image();
      image.src = document.getElementById("canvas").toDataURL("image/png");
      var b64 = image.src.substring(22);
      var myDate = new Date();
      var filename = myDate.getTime();
      return image;*/
    }
    
    
    function gotStream(stream) {
      alert("正在启动摄像头，请稍等……");
      var video=document.getElementById("video"); 
      
      if (navigator.mozGetUserMedia) {
          video.mozSrcObject = stream;
        } else {
          var vendorURL = window.URL || window.webkitURL;
          video.src = vendorURL.createObjectURL(stream);
        }
      
      video.play();  
    }
    
    function noStream(err){
      alert("An error occured! " + err);
    }
  </script>  
</body>
</html>  
